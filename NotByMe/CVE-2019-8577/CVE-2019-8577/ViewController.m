//
//  ViewController.m
//  CVE-2019-8577
//
//  Created by codecolorist on 2019/5/15.
//  Copyright Â© 2019 CodeColorist. All rights reserved.
//

#import "ViewController.h"
#import "poc.h"

@import MediaPlayer;

@interface ViewController ()

@end

@implementation ViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    // Do any additional setup after loading the view, typically from a nib.
}

- (void)alert:(NSString *)title withContent:(NSString *)msg {
    dispatch_sync(dispatch_get_main_queue(), ^{
        UIAlertController *alertController = [UIAlertController alertControllerWithTitle:title message:msg preferredStyle:UIAlertControllerStyleAlert];
        UIAlertAction *okAction = [UIAlertAction actionWithTitle:@"OK" style:UIAlertActionStyleDefault handler:nil];
        [alertController addAction:okAction];
        [self presentViewController:alertController animated:YES completion:nil];
    });
}

- (IBAction)trigger:(id)sender {
    [MPMediaLibrary requestAuthorization:^(MPMediaLibraryAuthorizationStatus status) {
        if (status != MPMediaLibraryAuthorizationStatusAuthorized)
            [self alert:@"Authorization failure" withContent:@"Plaease allow access to the media library"];
        
        NSError *err = poc();
        if (err)
            [self alert:@"Error" withContent:[err localizedDescription]];
        else
            [self alert:@"Success" withContent:@"Plaease check the crash log of medialibraryd"];
    }];
}

@end
